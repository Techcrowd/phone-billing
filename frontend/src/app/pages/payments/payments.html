<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-5">
  <h2 class="text-xl font-bold text-gray-900">Platby</h2>
  <div class="grid grid-cols-2 sm:flex gap-2 sm:gap-3">
    <select
      [(ngModel)]="selectedGroup"
      (ngModelChange)="loadPayments()"
      class="px-3 py-2 sm:py-1.5 border border-gray-200 rounded-lg text-sm bg-white"
    >
      <option value="">Všechny skupiny</option>
      @for (g of groups(); track g.id) {
        <option [value]="g.id">{{ g.name }}</option>
      }
    </select>
    <select
      [(ngModel)]="selectedPeriod"
      (ngModelChange)="loadPayments()"
      class="px-3 py-2 sm:py-1.5 border border-gray-200 rounded-lg text-sm bg-white"
    >
      <option value="">Všechna období</option>
      @for (inv of invoices(); track inv.id) {
        <option [value]="inv.period">{{ formatPeriod(inv.period) }}</option>
      }
    </select>
    @if (payments().length > 0) {
      <button
        (click)="exportPdf()"
        class="col-span-2 sm:col-span-1 px-4 py-2 sm:py-1.5 bg-pink-600 text-white rounded-lg text-sm font-medium hover:bg-pink-700 transition-colors flex items-center justify-center gap-1.5"
      >
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"
          />
        </svg>
        Export PDF
      </button>
    }
  </div>
</div>

@if (payments().length > 0) {
  <!-- KPI -->
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
    <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
      <p class="text-xs font-medium text-gray-400 uppercase tracking-wider">Celkem</p>
      <p class="text-xl font-bold text-gray-900 mt-1">
        {{ totalDue() | currency: 'CZK' : 'symbol' : '1.0-0' : 'cs' }}
      </p>
      <p class="text-xs text-gray-400 mt-0.5">
        {{ totalDueNoVat() | currency: 'CZK' : 'symbol' : '1.0-0' : 'cs' }} bez DPH
      </p>
    </div>
    <div class="bg-white rounded-xl p-4 shadow-sm border border-emerald-100">
      <p class="text-xs font-medium text-emerald-500 uppercase tracking-wider">Zaplaceno</p>
      <p class="text-xl font-bold text-emerald-600 mt-1">
        {{ totalPaid() | currency: 'CZK' : 'symbol' : '1.0-0' : 'cs' }}
      </p>
      <p class="text-xs text-emerald-400 mt-0.5">
        {{ totalPaidNoVat() | currency: 'CZK' : 'symbol' : '1.0-0' : 'cs' }} bez DPH
      </p>
    </div>
    <div class="bg-white rounded-xl p-4 shadow-sm border border-red-100">
      <p class="text-xs font-medium text-red-400 uppercase tracking-wider">Zbývá</p>
      <p class="text-xl font-bold text-red-600 mt-1">
        {{ totalUnpaid() | currency: 'CZK' : 'symbol' : '1.0-0' : 'cs' }}
      </p>
      <p class="text-xs text-red-300 mt-0.5">
        {{ totalUnpaidNoVat() | currency: 'CZK' : 'symbol' : '1.0-0' : 'cs' }} bez DPH
      </p>
    </div>
  </div>

  <!-- Table -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
    <div
      class="grid grid-cols-[28px_1fr_auto] sm:grid-cols-[32px_auto_1fr_auto_auto_auto] gap-x-3 sm:gap-x-5 px-3 sm:px-5 py-2.5 bg-gray-50 border-b border-gray-100 text-xs font-semibold text-gray-400 uppercase tracking-wider"
    >
      <div></div>
      <div class="hidden sm:block">Období</div>
      <div>Skupina</div>
      <div class="text-right hidden sm:block">Bez DPH</div>
      <div class="text-right">S DPH</div>
      <div class="text-center w-24 hidden sm:block">Stav</div>
    </div>
    @for (p of payments(); track p.id) {
      <label
        class="grid grid-cols-[28px_1fr_auto] sm:grid-cols-[32px_auto_1fr_auto_auto_auto] gap-x-3 sm:gap-x-5 items-center px-3 sm:px-5 py-3 border-b border-gray-50 last:border-0 transition-colors cursor-pointer"
        [class.bg-emerald-50/30]="p.is_paid"
        [class.hover:bg-gray-50/50]="!p.is_paid"
        [class.hover:bg-emerald-50/50]="p.is_paid"
      >
        <div class="flex items-center justify-center">
          <input
            type="checkbox"
            [checked]="p.is_paid"
            (change)="togglePaid(p, !p.is_paid)"
            class="w-4 h-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500 cursor-pointer"
          />
        </div>
        <div
          class="text-sm tabular-nums w-24 hidden sm:block"
          [class.text-gray-500]="!p.is_paid"
          [class.text-emerald-700]="p.is_paid"
        >
          {{ formatPeriod(p.period) }}
        </div>
        <div
          class="text-sm truncate"
          [class.font-medium]="!p.is_paid"
          [class.text-gray-800]="!p.is_paid"
          [class.text-emerald-700]="p.is_paid"
        >
          {{ p.group_name }}
        </div>
        <div
          class="text-right text-sm tabular-nums hidden sm:block"
          [class.text-gray-500]="!p.is_paid"
          [class.text-emerald-600]="p.is_paid"
          [class.opacity-60]="p.is_paid"
        >
          {{ p.amount_without_vat | currency: 'CZK' : 'symbol' : '1.0-0' : 'cs' }}
        </div>
        <div
          class="text-right font-semibold tabular-nums text-sm"
          [class.text-gray-900]="!p.is_paid"
          [class.text-emerald-600]="p.is_paid"
          [class.line-through]="p.is_paid"
          [class.opacity-60]="p.is_paid"
        >
          {{ p.amount | currency: 'CZK' : 'symbol' : '1.0-0' : 'cs' }}
        </div>
        <div class="text-center w-24 hidden sm:block">
          @if (p.is_paid) {
            <span
              class="text-xs font-medium bg-emerald-100 text-emerald-700 px-2.5 py-1 rounded-full"
            >
              Zaplaceno
            </span>
          } @else {
            <span class="text-xs font-medium bg-red-50 text-red-500 px-2.5 py-1 rounded-full">
              Nezaplaceno
            </span>
          }
        </div>
      </label>
    }
  </div>
} @else {
  <div class="text-center py-16 text-gray-400">
    @if (selectedPeriod || selectedGroup) {
      Žádné platby pro zvolený filtr.
    } @else {
      Žádné platby. Nahrajte fakturu — platby se vygenerují automaticky.
    }
  </div>
}
